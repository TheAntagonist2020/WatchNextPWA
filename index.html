<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="WatchNext">
  <meta name="theme-color" content="#7c5cfc">
  <meta name="mobile-web-app-capable" content="yes">

  <title>What to Watch Next</title>

  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icons/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
  <link rel="stylesheet" href="app.css">

  <!-- Splash screens for iOS -->
  <meta name="apple-mobile-web-app-capable" content="yes">
</head>
<body>
  <div id="app">
    <!-- Header -->
    <header>
      <div class="logo">
        <svg width="26" height="26" viewBox="0 0 24 24" fill="none">
          <rect x="2" y="3" width="20" height="14" rx="2" stroke="currentColor" stroke-width="2"/>
          <path d="M10 9L15 12L10 15V9Z" fill="currentColor"/>
          <path d="M8 21H16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          <path d="M12 17V21" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
        <h1>What to Watch</h1>
      </div>
      <button id="settingsBtn" class="icon-btn" aria-label="Settings">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M12.22 2h-.44a2 2 0 00-2 2v.18a2 2 0 01-1 1.73l-.43.25a2 2 0 01-2 0l-.15-.08a2 2 0 00-2.73.73l-.22.38a2 2 0 00.73 2.73l.15.1a2 2 0 011 1.72v.51a2 2 0 01-1 1.74l-.15.09a2 2 0 00-.73 2.73l.22.38a2 2 0 002.73.73l.15-.08a2 2 0 012 0l.43.25a2 2 0 011 1.73V20a2 2 0 002 2h.44a2 2 0 002-2v-.18a2 2 0 011-1.73l.43-.25a2 2 0 012 0l.15.08a2 2 0 002.73-.73l.22-.39a2 2 0 00-.73-2.73l-.15-.08a2 2 0 01-1-1.74v-.5a2 2 0 011-1.74l.15-.09a2 2 0 00.73-2.73l-.22-.38a2 2 0 00-2.73-.73l-.15.08a2 2 0 01-2 0l-.43-.25a2 2 0 01-1-1.73V4a2 2 0 00-2-2z"/>
          <circle cx="12" cy="12" r="3"/>
        </svg>
      </button>
    </header>

    <!-- Settings Panel (slide-down) -->
    <div id="settingsPanel" class="panel hidden">
      <div class="panel-inner">
        <h2>Settings</h2>
        <div class="setting-group">
          <label for="apiKeyInput">MDBList API Key</label>
          <div class="input-row">
            <input type="password" id="apiKeyInput" placeholder="Paste your API key" autocomplete="off" autocapitalize="off" autocorrect="off">
            <button id="toggleKey" class="icon-btn small" aria-label="Show/Hide key">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/>
              </svg>
            </button>
          </div>
        </div>
        <div class="setting-group">
          <label for="defaultList">Default List Source</label>
          <select id="defaultList">
            <option value="top">Top Lists (Popular)</option>
            <option value="my">My Lists</option>
          </select>
        </div>
        <div class="setting-group">
          <label for="letterboxdFile">Letterboxd Watched Import</label>
          <p class="help-text">
            Upload your Letterboxd export CSV (watched.csv, diary.csv, or films.csv).
            We match by Name/Title + Year (or IMDb ID when available) to hide watched picks.
            <a href="https://letterboxd.com/settings/data/" target="_blank" rel="noreferrer">Download export</a>
          </p>
          <div class="input-row">
            <input type="file" id="letterboxdFile" accept=".csv,text/csv" multiple>
            <button id="clearLetterboxd" class="btn secondary small" type="button">Clear</button>
          </div>
          <div class="stat-row">
            <span id="letterboxdStatus" class="status-pill">No data imported</span>
            <label class="toggle">
              <input type="checkbox" id="hideWatchedToggle" checked>
              <span>Hide watched picks</span>
            </label>
          </div>
        </div>
        <div class="btn-row">
          <button id="saveSettings" class="btn primary">Save</button>
          <button id="cancelSettings" class="btn secondary">Cancel</button>
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <main id="mainView">
      <!-- Filters -->
      <div class="filters">
        <div class="filter-group">
          <label>Genre</label>
          <select id="genreFilter"><option value="">Any Genre</option></select>
        </div>
        <div class="filter-group">
          <label>Type</label>
          <select id="typeFilter">
            <option value="movie">Movies</option>
            <option value="show">TV Shows</option>
            <option value="">Any</option>
          </select>
        </div>
        <div class="filter-group">
          <label>Min Score</label>
          <select id="scoreFilter">
            <option value="0">Any</option>
            <option value="50">50+</option>
            <option value="60">60+</option>
            <option value="70" selected>70+</option>
            <option value="80">80+</option>
          </select>
        </div>
      </div>

      <!-- List Picker -->
      <div class="list-selector">
        <label>Pick from list</label>
        <select id="listSelect"><option value="">Loading lists...</option></select>
      </div>

      <!-- Big Action Button -->
      <div class="action-area">
        <button id="pickBtn" class="btn primary hero-btn">
          <div class="hero-icon">
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none">
              <path d="M23 7l-7 5 7 5V7z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
              <rect x="1" y="5" width="15" height="14" rx="2" stroke="currentColor" stroke-width="2"/>
            </svg>
          </div>
          <span>Pick Something for Me</span>
        </button>

        <button id="searchBtn" class="btn secondary full-width">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/>
          </svg>
          Search
        </button>
      </div>

      <!-- Search Panel -->
      <div id="searchPanel" class="hidden">
        <div class="search-bar">
          <input type="search" id="searchInput" placeholder="Search movies or shows..." autocomplete="off" autocapitalize="off" enterkeyhint="search">
          <button id="searchGoBtn" class="btn primary small">Go</button>
        </div>
        <div id="searchResults" class="results-list"></div>
      </div>

      <!-- Result Card -->
      <div id="resultCard" class="card hidden">
        <div class="card-dismiss">
          <button id="dismissCard" class="icon-btn small" aria-label="Dismiss">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M18 6L6 18M6 6l12 12"/>
            </svg>
          </button>
        </div>
        <div class="card-header">
          <div id="resultPoster" class="poster">
            <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="var(--text-dim)" stroke-width="1">
              <rect x="2" y="3" width="20" height="14" rx="2"/><path d="M10 9l5 3-5 3V9z"/>
            </svg>
          </div>
          <div class="card-info">
            <h3 id="resultTitle">-</h3>
            <div class="meta-row">
              <span id="resultYear" class="tag">-</span>
              <span id="resultType" class="tag">-</span>
              <span id="resultRuntime" class="tag">-</span>
            </div>
            <div class="score-row">
              <div class="score-badge" id="resultScore">-</div>
              <span class="score-label">MDBList Score</span>
            </div>
          </div>
        </div>
        <div class="card-body">
          <p id="resultDescription" class="description">-</p>
          <div id="resultGenres" class="genre-tags"></div>
          <div class="ratings-grid" id="resultRatings"></div>
        </div>
        <div class="card-actions stacked">
          <button id="watchOnStremioWeb" class="btn stremio full-width">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
              <path d="M8 5v14l11-7L8 5z"/>
            </svg>
            Watch on Stremio Web
          </button>
          <div class="card-actions-row">
            <button id="watchOnStremioApp" class="btn secondary">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="5" y="2" width="14" height="20" rx="2"/><path d="M12 18h.01"/>
              </svg>
              Stremio Lite
            </button>
            <button id="pickAnother" class="btn secondary">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M1 4v6h6"/><path d="M3.51 15a9 9 0 102.13-9.36L1 10"/>
              </svg>
              Another
            </button>
          </div>
        </div>
      </div>

      <!-- History -->
      <div id="historySection" class="hidden">
        <div class="section-header">
          <h3>Recent Picks</h3>
          <button id="clearHistory" class="text-btn">Clear</button>
        </div>
        <div id="historyList" class="history-list"></div>
      </div>
    </main>

    <!-- Loading Overlay -->
    <div id="loading" class="loading hidden">
      <div class="spinner-wrap">
        <div class="spinner"></div>
      </div>
      <span id="loadingText">Finding something great...</span>
    </div>

    <!-- Status Bar -->
    <footer id="statusBar">
      <span id="statusText">Ready</span>
      <span id="apiCalls" class="api-counter">-</span>
    </footer>
  </div>

  <script src="app.js"></script>
</body>
</html>
